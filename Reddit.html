<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Organic Suite — Reddit Viewer</title>
<style>
/* -------------------
  Banner (from Products.html)
-------------------- */
header.banner{
  padding:48px 24px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background: linear-gradient(90deg, #8fc6a3, #6faf8a);
  box-shadow: 0 3px 16px rgba(0,0,0,0.15);
}
header.banner h1{
  margin:0;
  font-size: clamp(28px,4vw,44px);
  font-weight:800;
  letter-spacing:-0.6px;
  color:#042615;
}
.cta{display:flex; gap:12px;}
.link-muted{display:inline-block; padding:10px 14px; border-radius:12px;
background:rgba(255,255,255,0.2); color:#042615; font-weight:600; text-decoration:none;}
.btn{padding:10px 18px; border:none; border-radius:12px;
background: linear-gradient(180deg, #8fc6a3, #6faf8a);
color:#042615; font-weight:600; box-shadow:0 8px 24px rgba(0,0,0,0.35); cursor:pointer;}

/* -------------------
  Light mode layout
-------------------- */
:root{
  --bg:#f5f5f5;
  --card:#ffffff;
  --card-border:#d8e0d8;
  --muted:#6f6f6f;
  --radius:14px;
  --shadow:0 6px 20px rgba(0,0,0,0.12);
}

html,body{
  margin:0; padding:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto;
  background:#f5f5f5; color:#042615; height:100%; width:100%;
}

main.wrapper{max-width:1250px; margin:34px auto; padding:0 24px;
display:grid; grid-template-columns:1fr 350px; gap:28px;}
.search-card{background: var(--card); border:1px solid var(--card-border);
border-radius:var(--radius); display:flex; align-items:center; gap:12px; padding:16px;}
.search-input{flex:1; padding:10px; background:transparent; border:none;
outline:none; color:#042615; font-size:1rem;}
select{background:rgba(0,0,0,0.02); border:1px solid #d8e0d8; border-radius:10px;
padding:8px; color:#042615;}
#results{margin-top:18px; display:flex; flex-direction:column; gap:12px;}
.post{display:flex; gap:12px; padding:16px; border-radius:var(--radius);
background:var(--card); border:1px solid var(--card-border); transition:0.2s;}
.post:hover{transform:translateY(-3px); box-shadow:var(--shadow); cursor:pointer;}
.thumb{width:92px; height:72px; border-radius:12px; background:rgba(0,0,0,0.02);
display:flex; align-items:center; justify-content:center; overflow:hidden;}
.thumb img{width:100%; height:100%; object-fit:cover;}
.meta{flex:1; display:flex; flex-direction:column; gap:6px;}
.title{margin:0; font-weight:600; font-size:1.05rem; color:#042615;}
.sub{margin:0; color:var(--muted); font-size:0.88rem;}
aside.panel{padding:16px; background:var(--card); border-radius:var(--radius);
border:1px solid var(--card-border);}
aside.panel h3{margin:0 0 12px 0;}
.rec-item{display:flex; justify-content:space-between; padding:10px; border-radius:12px;
background:rgba(0,0,0,0.02); border:1px solid rgba(0,0,0,0.02); margin-bottom:10px; transition:0.12s;}
.rec-item:hover{transform:translateX(4px); cursor:pointer;}
.sub-name{font-weight:600; color:#042615;}
.sub-desc{font-size:0.85rem; color:var(--muted);}
footer{margin:60px 0 40px; text-align:center; font-size:0.9rem; color:var(--muted);}
@media(max-width:960px){main.wrapper{grid-template-columns:1fr;}}

/* -------------------
  Fullscreen overlay for posts
-------------------- */
#overlay{display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background: rgba(0,0,0,0.95); z-index:9999; overflow-y:auto; padding:24px; box-sizing:border-box; color:#042615;}
#overlay .close-btn{position:fixed; top:24px; right:24px; font-size:1.6rem;
background: rgba(255,255,255,0.2); border:none; border-radius:50%; width:40px; height:40px; cursor:pointer; color:#042615;}
#overlay h2{margin-top:0;}
#overlay img, #overlay video{max-width:100%; margin-top:12px; border-radius:12px;}
.comment{margin-left:20px; margin-top:12px; padding:8px; border-left:2px solid rgba(0,0,0,0.1);}
.comment-author{font-weight:600; font-size:0.9rem;}
.comment-meta{font-size:0.75rem; color:#6f6f6f;}
.comment-text{margin:4px 0 0 0;}
</style>
</head>
<body>

<header class="banner">
<h1>Organic Suite</h1>
<div class="cta">
  <a class="link-muted" href="https://github.com/Soupmax22/Organic-suite" target="_blank">View on GitHub</a>
  <button class="btn" id="see-products">See all products</button>
</div>
</header>

<main class="wrapper">
<section>
  <div class="search-card">
    <input class="search-input" id="searchInput" placeholder="Search Reddit…">
    <select id="sort">
      <option value="relevance">Relevance</option>
      <option value="hot">Hot</option>
      <option value="new">New</option>
      <option value="top">Top</option>
    </select>
    <button class="btn" id="searchBtn">Search</button>
  </div>
  <p style="color:var(--muted); margin-top:8px;">Reddit may be blocked at school. Use local JSON below.</p>
  <div style="display:flex; gap:8px; margin-top:8px;">
    <button class="link-muted" id="loadLocal">Load local JSON</button>
    <input id="localFile" type="file" accept=".json" style="display:none;">
  </div>
  <div id="results"></div>
</section>

<aside class="panel">
  <h3>Recommended</h3>
  <div id="recs"></div>
</aside>
</main>

<footer>© 2025 Organic Suite — ad-free Reddit viewer</footer>

<!-- Fullscreen overlay -->
<div id="overlay">
  <button class="close-btn">&times;</button>
  <div id="overlay-content"></div>
</div>

<script>
// DOM references
const resultsEl = document.getElementById("results");
const recsEl = document.getElementById("recs");
const searchInput = document.getElementById("searchInput");
const sortSel = document.getElementById("sort");
const overlay = document.getElementById("overlay");
const overlayContent = document.getElementById("overlay-content");

// Open GitHub
document.getElementById("see-products").onclick = () =>
  window.open("https://github.com/Soupmax22/Organic-suite","_blank");

// Local JSON fallback
document.getElementById("loadLocal").onclick = ()=>document.getElementById("localFile").click();
document.getElementById("localFile").addEventListener("change", async ev=>{
  const file = ev.target.files[0];
  const txt = await file.text();
  try{
    const json = JSON.parse(txt);
    const posts = json.data ? json.data.children.map(c=>c.data) : json;
    renderPosts(posts);
  }catch{
    alert("Invalid JSON");
  }
});

// Search
async function searchReddit(query, sort){
  const res = await fetch(`https://www.reddit.com/search.json?q=${encodeURIComponent(query)}&limit=30&sort=${sort}`);
  const json = await res.json();
  return json.data.children.map(c=>c.data);
}

async function runSearch(){
  const q = searchInput.value.trim();
  if(!q){ resultsEl.innerHTML="<p style='color:var(--muted)'>Type something to search.</p>"; return; }
  resultsEl.innerHTML="<p style='color:var(--muted)'>Loading…</p>";
  try{
    const posts = await searchReddit(q, sortSel.value);
    renderPosts(posts);
    populateRecs(posts);
  }catch{
    resultsEl.innerHTML="<p style='color:var(--muted)'>Cannot reach Reddit. Use local JSON.</p>";
  }
}
document.getElementById("searchBtn").onclick=runSearch;
searchInput.onkeyup=e=>{if(e.key==="Enter") runSearch();};

// Render posts
function renderPosts(posts){
  resultsEl.innerHTML="";
  posts.forEach(p=>{
    const post = document.createElement("div");
    post.className="post";

    const meta = document.createElement("div"); meta.className="meta";
    const title = document.createElement("h4"); title.className="title"; title.textContent=p.title;
    const sub = document.createElement("p"); sub.className="sub";
    sub.textContent=`r/${p.subreddit} • u/${p.author} • ${p.ups} upvotes`;
    meta.append(title,sub);

    const thumb = document.createElement("div"); thumb.className="thumb";
    let imgURL="";
    if(p.thumbnail && p.thumbnail.startsWith("http") && !["self","default","nsfw","image","spoiler"].includes(p.thumbnail))
      imgURL=p.thumbnail;
    if(!imgURL && p.preview?.images?.[0]) imgURL=p.preview.images[0].source.url.replace(/&amp;/g,"&");
    if(imgURL){
      const img=document.createElement("img"); img.src=imgURL; thumb.appendChild(img);
      post.append(thumb,meta);
    } else {
      post.append(meta);
    }

    post.onclick=()=>showOverlay(p);
    resultsEl.appendChild(post);
  });
}

// Recommended subreddits
function populateRecs(posts){
  recsEl.innerHTML="";
  const freq={};
  posts.forEach(p=>freq[p.subreddit]=(freq[p.subreddit]||0)+1);
  Object.keys(freq).sort((a,b)=>freq[b]-freq[a]).slice(0,4).forEach(s=>addRecItem(s,"Top results"));
  ["technology","gaming","aww","pics"].forEach(s=>addRecItem(s,"Open subreddit"));
}
function addRecItem(name,desc){
  const div=document.createElement("div"); div.className="rec-item";
  div.innerHTML=`<div><div class="sub-name">r/${name}</div><div class="sub-desc">${desc}</div></div><div style="opacity:.6">›</div>`;
  div.onclick=async()=>{
    const r = await fetch(`https://www.reddit.com/r/${name}.json`);
    const j = await r.json();
    renderPosts(j.data.children.map(c=>c.data));
  };
  recsEl.appendChild(div);
}

// Overlay viewer with nested comments
async function showOverlay(post){
  overlayContent.innerHTML="";
  const h2=document.createElement("h2"); h2.textContent=post.title; overlayContent.appendChild(h2);
  const meta=document.createElement("p");
  meta.textContent=`r/${post.subreddit} • u/${post.author} • ${post.ups} upvotes • ${new Date(post.created_utc*1000).toLocaleString()}`;
  overlayContent.appendChild(meta);

  if(post.selftext){ const p=document.createElement("p"); p.textContent=post.selftext; overlayContent.appendChild(p); }
  if(post.preview?.images?.[0]){
    const img=document.createElement("img"); img.src=post.preview.images[0].source.url.replace(/&amp;/g,"&");
    overlayContent.appendChild(img);
  }
  if(post.media?.reddit_video?.fallback_url){
    const vid=document.createElement("video"); vid.src=post.media.reddit_video.fallback_url; vid.controls=true;
    overlayContent.appendChild(vid);
  }

  // Fetch comments
  try{
    const res=await fetch(`https://www.reddit.com${post.permalink}.json`);
    const json=await res.json();
    const comments=json[1].data.children.filter(c=>c.kind==="t1").map(c=>c.data);
    comments.forEach(c=>renderComment(c,overlayContent,0));
  }catch(e){console.log("Comments error",e);}
  overlay.style.display="block";
}

function renderComment(comment,parent,level){
  const div=document.createElement("div"); div.className="comment";
  div.style.marginLeft=(level*20)+"px";
  const author=document.createElement("div"); author.className="comment-author"; author.textContent=comment.author;
  const meta=document.createElement("div"); meta.className="comment-meta"; meta.textContent=`${comment.ups} upvotes • ${new Date(comment.created_utc*1000).toLocaleString()}`;
  const text=document.createElement("div"); text.className="comment-text"; text.innerHTML=comment.body_html.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");
  div.append(author,meta,text); parent.appendChild(div);
  if(comment.replies && comment.replies.data){
    comment.replies.data.children.filter(c=>c.kind==="t1").forEach(c=>renderComment(c.data,div,level+1));
  }
}

// Overlay close
overlay.querySelector(".close-btn").onclick=()=>{overlay.style.display="none";}
overlay.onclick=e=>{if(e.target===overlay) overlay.style.display="none";}
</script>
</body>
</html>
